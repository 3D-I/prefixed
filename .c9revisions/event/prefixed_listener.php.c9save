{"ts":1345669103719,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"<?php\n\nuse Symfony\\Component\\EventDispatcher\\EventSubscriberInterface;\n\nclass phpbb_ext_imkingdavid_prefixed_event_prefixed_listener implements EventSubscriberInterface\n{\n\tprivate $db;\n\tprivate $cache;\n\tprivate $template;\n\tprivate $base;\n\n\tpublic function __construct()\n\t{\n\t\tglobal $db, $cache, $template, $table_prefix;\n\n\t\t// Let's get our table constants out of the way\n\t\tdefine('PREFIXES_TABLE', $table_prefix . 'topic_prefixes');\n\t\tdefine('PREFIXES_USED_TABLE', $table_prefix . 'topic_prefixes_used');\n\n\t\t$this->db = $db;\n\t\t$this->cache = $cache;\n\t\t$this->template = $template;\n\t\t$this->base = new phpbb_ext_imkingdavid_prefixed_core_base($db, $cache);\n\t}\n\n\tstatic public function getSubscribedEvents()\n\t{\n\t\treturn array(\n\t\t\t'core.viewtopic_page_header' => 'get_viewtopic_topic_prefix',\n\t\t\t'core.viewforum_topicrow' => 'get_viewforum_topic_prefixes',\n\t\t);\n\t}\n\n\tpublic function get_viewtopic_topic_prefix($event)\n\t{\n\t\t$data = $event->get_data();\n\n\t\tif ($this->base->load_all() && $this->base->load_all_used())\n\t\t{\n\t\t\t$this->template->assign_vars(array(\n\t\t\t\t'TOPIC_PREFIX' => $this->base->load_topic_prefixes($data['topic_data']['topic_id']),\n\t\t\t));\n\t\t\t$data['page_title'] = $this->base->load_topic_prefixes($data['topic_data']['topic_id'], false) . '&nbsp;' . $data['page_title'];\n\t\t}\n\n\t\t$event->set_data($data);\n\t}\n\n\tpublic function get_viewforum_topic_prefixes($event)\n\t{\n\t\t$data = $event->get_data();\n\t\tif ($this->base->load_all() && $this->base->load_all_used())\n\t\t{\n\t\t\t$data['topicrow']['TOPIC_PREFIX'] = $this->base->load_topic_prefixes($data['topicrow']['TOPIC_ID']);\n\t\t}\n\n\t\t$event->set_data($data);\n\t}\n}\n"]],"start1":0,"start2":0,"length1":0,"length2":1615}]],"length":1615}
