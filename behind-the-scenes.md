Background
------
For phpBB 3.0.x, I developed a MOD called Topic Multi-Moderation and Topic Prefixes. That's really two MODs, but I bundled them together because I felt the former of the two (multi-moderation) should be able to affix prefixes to topics by default. Also, if I had made them separate MODs, there was not a simple way of making the two automatically work together when both were present without modifying the code of both MODs further than if you were to just install one or the other.

With MODs, the core concept is made clear by the name ("Modification"): add/change features by modifying code. On the other hand, the idea of an Extension is completely different. Its core concept is *code injection*. Rather than altering the core software's code, files containing additional code are loaded by a series of "events" (or "hooks"), ultimately *injecting* the 3rd party code into the core code, as if it were there to begin with. I suppose the main difference between the two is that with a MOD, code is injected by the developer into the file itself, whereas with an extension, code is injected at runtime by the Event manager.

The main reason I decided to make the Topic Prefixes portion of my 3.0.x MOD into a standalone extension is because doing so is much easier with extensions and events. I am able to use events to detect the presence of one extension from the other one. For instance, I can define an event listener to gather prefix token analysers (I'll talk more about tokens later, probably) in my Topic Prefixes extension, and then add that event in my Topic Multi-Moderation extension (whenever I get around to making it, that is).

This introduction has been a bit long, but let me quickly summarize my plan for the remainder of this document. I intend to guide you through the file/directory structure, explaining what files accomplish what purposes, etc. I know a lot of information is already contained in the phpBB Wiki, but some is not, and this gives me a way to explain with a real life example the concepts that are outlined in the wiki.


Files & Directories
-------
- **acp** - This contains my ACP module files. *This directory name is used by the module management class.*
    - *prefixed_module.php* - This is the content file of the ACP module. It is basically the same thing you'd find in ./includes/acp/acp_*.php in the phpBB core files.
    - *prefixed_info.php* - This is the information file of the ACP module, containing the module information that is used to add the module to the phpBB installation. It is basically the same as what you'd find in ./includes/acp/info/acp_*.php
- **config** - This contains the configuration files for my extension. *This directory name is used by the configuration file loaders.*
    - *services.yml* - This file contains service definitions for the classes added by my extension that can be used by the Dependency Injection Container. In general, but not without exception, services are classes that only need one instantiation across the entire software.
    - if I wanted a front-facing file, I would have a routing.yml file as well to contain the route definitions.
- **core** - This directory is arbitrarily named because it contains the *core* classes used by my extension. Your extension does not necessarily require a directory called *core*, but you are welcome to have one as well if you so desire.
    - *instance.php* - This file contains a class representing a single instance of a topic prefix. This was the most straight-forward way I could think of to allow you to define a prefix in the ACP and apply it to potentially more than one topic, while retaining instance-specific data (for instance the order among other prefixes, and tokens; this is data like the username of the user that applied the prefix, or the date on which the token was applied).
    - *loadable.php* - Because I require PHP 5.4 as a minimum, I am able to take advantage of a new datatype introduced in that version: traits; essentially, this is a collection of class methods that can be applied horizontally to multiple classes. Check the PHP manual for more information about traits. This file contains a trait that lets me implement loading methods on items that are loadable (for instance, I can load a prefix, or I can load a prefix instance, from the database)
    - *manager.php* - This file contains a class that is responsible for managing prefixes and prefix instances. It can perform actions such as creating or deleting a prefix and adding or removing a prefix instance from a topic.
    - *prefix.php* - This file contains a class representing a prefix. Simple, eh?
- **event** - This is where the fun begins. This directory houses event listener classes. Essentially, an event listener is a method that is executed every time a given event is triggered. In my case, I listen for the event that is triggered when the topic list is generated and append prefixes to the appropriate topic titles. **Note:** To work, files in this directory must end with the word "listener" (before the .php, of course). I simply chose to call the file "listener.php" because I only have the one file (multiple listeners can be inside) and didn't need any extra files.
    - *listener.php* - This file contains event listeners used by my extension. If you look closely, you'll notice that I even have a listener for an event this extension itself adds.
- **langauge** - I will refrain from disecting this directory and its contents because it's pretty straight forward, and is pretty much exactly what you'd find in the default phpBB directory.
- **migrations**
   - This directory contains my Migrations files. Migrations are the new way to keep track of database changes across different versions of your extension. While filename can be arbitrary, I recommend prefixing whatever name you choose with a number, like I do, so you can see them in chronological order. I also separated my schema changes and data changes into two files, but that is not necessary. You can separate yours as much as you like, or clump it all into one file. Just keep one thing in mind: a migration is meant to be left untouched once it's released. If you need to undo a change, just make a new migration file. **Note:** See the wiki for a vastly larger amount of information about Migrations.
- **styles**
    - Just like in the phpBB software itself, this contains your style and template files. This is also where you put in your template event listeners. Basically, a template event listener is an HTML file named exactly like the template event, with .html added at the end. So if you are wanting to inject template code into an event named 'foo_bar', your listener file would be 'foo_bar.html'.
    - The 'all' directory is used as a fallback for template events only. If you have a template event that is not style-specific and you would rather not include it in both the prosilver and subsilver directories, you can put it into the 'all' directory and it will be loaded. Note that if you have a listener in both the 'prosilver' and the 'all' directories, and the user is viewing the prosilver style, the listener from the 'prosilver' directory will be used, rather than the one from 'all'.
    - Do not rely on 'all' for normal template file loading, as the template system still requires any compiled template files to be loaded from the style you are browsing.
- **composer.json** - This is the Extension meta-data file. This essentially accomplishes the same purpose as the header block of a MODX install file. You can specify your name, email, etc., the extension version, minimum PHP/phpBB version requirements, etc.
- **ext.php** - You will see that this file contains an empty class that extends the phpbb_extension_base class. This file/class is required in order for phpBB to recognize your extension and display it in the list. While it is not required to do anything else, it can be used to execute custom actions during the enable, disable, and purge steps. Migrations are run automatically, but you may wish to perform some other action when your extension is being enabled, so this allows you to do so, using the (enable/disable/purge)_step() methods. You can see other methods you can use by viewing the parent class and looking at its methods.
